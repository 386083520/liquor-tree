<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>Tree</title>
    <style media="screen">
        .app,
        .app2 {
            width: 340px;
            font-size: 15px;
            float: left;
        }

        .logger {
          clear: both;
          height: 300px;
          overflow: auto;
          border: 1px solid #eee
        }

        .logger p {
          margin: 0
        }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <div id="app2"></div>

    <div class="logger">

    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
    <script src="liquor-tree.umd.js"></script>

    <template id="demo">
        <div class="app">
            <h3>Tree select</h3>
            <tree
                :data="data"
                :options="options"
                ref="tree"
            />
        </div>
    </template>

   <template id="demo2">
        <div class="app2">
            <h3>Tree checkbox</h3>
            <tree
                :data="data"
                :options="{checkbox: true, parentSelect: true}"
                ref="tree"
            />
        </div>
    </template>

    <script type="text/javascript">
        let data = _ => ([
            {
                text: 'Item 1',
                state: {
                    selected: true
                },
                id: 1123123
            },

            {
                text: 'Item 2',
                children: [
                    {text: '<b>Item 2.1</b>', state: {checked: true}},
                    {text: 'Item 2.2'},
                    {
                        text: 'Item 2.3',
                        children: [
                            {text: 'Item 2.2.3.1'},
                            {text: 'Item 2.2.3.2'},
                            {text: 'Item 2.2.3.3'},
                            {text: 'Item 2.2.3.4', children: [
                                {text: 'Item 2.2.3.4.1'},
                                {text: 'Item 2.2.3.4.2'}
                            ]}
                        ]
                    },
                    {text: 'Item 2.4'}
                ]
            },

            {
                text: 'Item 3',
                id: 1111111111,
                state: {selected: true}
            },

            {
                text: 'Item 4'
            },

            {
                text: 'Item 5',
                state: {
                    opened: true
                },
                children: [
                    {text: 'Item 5.1'},
                    {text: 'Item 5.2'},
                    {text: 'Item 5.3'}
                ],
                id: 222
            }

        ]);

        let data2 = _ => ([
          {
            text: 'JS: The Right Way',

            // it makes node expanded
            state: { expanded: true },
            children: [
              { text: 'Getting Started' },
              { text: 'JavaScript Code Style', state: { selected: true } },
              { text: 'The Good Parts', children: [
                { text: 'OBJECT ORIENTED' },
                { text: 'ANONYMOUS FUNCTIONS' },
                { text: 'FUNCTIONS AS FIRST-CLASS OBJECTS' },
                { text: 'LOOSE TYPING' }
              ]},
              { text: 'Patterns', children: [
                { text: 'DESIGN PATTERNS', state: { expanded: true }, children: [
                  { text: 'Creational Design Patterns', children: [
                    { text: 'Factory' },
                    { text: 'Prototype' },
                    { text: 'Mixin' },
                    { text: 'Singleton' }
                  ]},
                  { text: 'Structural Design Patterns'}
                ]},
                { text: 'MV* PATTERNS', cildren: [
                  { text: 'MVC Pattern' },
                  { text: 'MVP Pattern' },
                  { text: 'MVVM Pattern' }
                ]}
              ]}
            ]
          }
        ]);

        // yeah.. :-D
        let $logger = document.querySelector('.logger')
        let log = msg => {
          let p = document.createElement('p');
          let d = new Date

          if (!log._group) {
            log._group = {}
          }

          p.innerHTML = [
            d.getHours(),
            d.getMinutes(),
            d.getSeconds() < 10 ? '0' + d.getSeconds() : d.getSeconds()
          ].join(':') + ': ' + msg;

          if (!log._group[d.getMinutes() + d.getSeconds()]) {
            log._group[d.getMinutes() + d.getSeconds()] = true

              let delim = document.createElement('p')
              delim.innerHTML = '&nbsp;'
              $logger.prepend(delim)
          }

          $logger.prepend(p)
        }

        let events = [
          'node:selected',
          'node:unselected',
          'node:checked',
          'node:unchecked',
          'node:expanded',
          'node:collapsed',
          'node:shown',
          'node:hidden',
          'node:disabled',
          'node:enabled',
          'node:removed'
        ]

        function addEvents() {
          events.forEach(name => {
            (this.$refs.tree || this.$refs.tree2).$on(name, node => {
              log(`<b>${name}:</b> ${node.text}`)
            })
          })
        }

        let app = new Vue({
            el: '#app',
            template: '#demo',
            data() {
                return {
                    data: data2(),
                    options: {
                      multiple: true,
                      parentSelect: false
                    }
                }
            },

            mounted() {
              window.n = this.$refs.tree.selected()[0]
              addEvents.call(this)
            }
        });

        let app2 = new Vue({
            el: '#app2',
            template: '#demo2',
            data() {
                return {
                    data: data()
                }
            },

            mounted() {
              window.c = this.$refs.tree.checked()[0]
              addEvents.call(this)
            }
        });

        // let app = new Vue({
        //     el: '#app',
        //     template: `<div class="app"><calendar :readonly="true" :date="new Date"></calendar></div>`,
        //     created() {
        //
        //         this.$on('calendar:changed', (e) => {console.log(e);})
        //     }
        // });
    </script>

  </body>
</html>
